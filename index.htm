<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <div class="card">
      <h3>Upload Files</h3>
      <div class="drop_box">
        <header>
          <h4>Select File here</h4>
        </header>
        <p>Files Supported: PDF, TEXT, DOC , DOCX</p>
        <input type="file" hidden accept=".doc,.docx,.pdf" id="fileID" style="display:none;">
        <button class="btn">Choose File</button>
      </div>
      <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
      <h3 id="status"></h3>
      <p id="loaded_n_total"></p>

    </div>
  </div>
</body>
<script>
  const dropArea = document.querySelector(".drop_box"),
    button = dropArea.querySelector("button"),
    dragText = dropArea.querySelector("header"),
    input = dropArea.querySelector("input");
  let file;
  var filename;

  button.onclick = () => {
    input.click();
  };


  // input.addEventListener("change", function (e) {
  //   var fileName = e.target.files[0].name;
  //   var shortFileName = fileName.length > 20 ? fileName.substring(0, 20) + "..." : fileName; // Cắt tên file nếu dài hơn 20 ký tự
  //   let filedata = `
  //   <form id="uploadForm" method="post">
  //     <div class="form" data-fullname="${fileName}">
  //       <h4 class="file-name">${shortFileName}</h4>
  //       <button type="button" class="btn" onclick="uploadFile()">Upload</button>
  //     </div>
  //   </form>`;
  //   dropArea.innerHTML = filedata;
  // });


  input.addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (file) {
      const fileName = file.name;
      const shortFileName = fileName.length > 20 ?
        fileName.substring(0, 20) + "..." :
        fileName;

      const filedata = `
                    <form id="uploadForm" method="post">
                        <div class="form">
                            <h4 class="file-name" data-fullname="${fileName}">${shortFileName}</h4>
                            <button type="button" class="btn" onclick="uploadFile()">Upload</button>
                        </div>
                    </form>`;
      dropArea.innerHTML = filedata;
    }
  });





  function uploadFile() {
    let file = input.files[0];
    let formData = new FormData();
    formData.append("file", file);

    var ajax = new XMLHttpRequest();
    ajax.upload.addEventListener("progress", progressHandler, false);
    ajax.addEventListener("load", completeHandler, false);
    ajax.addEventListener("error", errorHandler, false);
    ajax.addEventListener("abort", abortHandler, false);
    ajax.open("POST", "http://localhost:8080/api/v1/upload"); // Thay thế 'your_upload_url_here' bằng URL thực tế
    ajax.send(formData);
  }

  function _(id) {
    return document.getElementById(id);
  }

  function progressHandler(event) {
    console.log("Uploading: " + event.loaded + " of " + event.total);
    // _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
    var percent = (event.loaded / event.total) * 100;
    const progressBar = _("progressBar");
    console.log("ProgressBar value before update: " + progressBar.value);
    progressBar.value = Math.round(percent);
    _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
    console.log("ProgressBar value after update: " + progressBar.value);
  }



  function completeHandler(event) {
    _("status").innerHTML = event.target.responseText;
    // _("progressBar").value = 0; // Clear progress bar after successful upload
  }

  function errorHandler(event) {
    _("status").innerHTML = "Upload Failed";
  }

  function abortHandler(event) {
    _("status").innerHTML = "Upload Aborted";
  }

</script>

</html> -->


<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Upload with Hover</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <div class="command">
      <table>
        <tbody>
          <tr>
            <td>Command:</td>
            <td>
              <input type="text" id="command_text">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="card">
      <h3>Upload Files</h3>
      <div class="drop_box">
        <header>
          <h4>Select File here</h4>
        </header>
        <input type="file" hidden id="fileID">
        <button class="btn">Choose File</button>
      </div>
      <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
      <h3 id="status"></h3>
      <p id="loaded_n_total"></p>
    </div>
  </div>

  <script>
    const dropArea = document.querySelector(".drop_box");
    const button = dropArea.querySelector("button");
    const input = dropArea.querySelector("input");

    button.onclick = () => {
      input.click();
    };

    input.addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        const fileName = file.name;
        const shortFileName = fileName.length > 20 ?
          fileName.substring(0, 20) + "..." :
          fileName;
        const filedata = `
                    <div class="file-info">
                        <span class="file-name" data-fullname="${fileName}">${shortFileName}</span>
                        <button type="button" class="btn" onclick="uploadFile()">Upload</button>
                    </div>`;
        dropArea.innerHTML = filedata;
      }
    });

    function uploadFile() {
      let formData = new FormData();
      let file = input.files[0];
      if (!file) return;
      const commandText = _("command_text");
      if(!commandText){
        return;
      }else{
        const command = commandText.value;
        if(!command){
          alert("Command text must be not null!")
          return;
        }
        else{
          formData.append("command",command);
        }
      }


     
      formData.append("file", file);

      var ajax = new XMLHttpRequest();
      ajax.upload.addEventListener("progress", progressHandler, false);
      ajax.addEventListener("load", completeHandler, false);
      ajax.addEventListener("error", errorHandler, false);
      ajax.addEventListener("abort", abortHandler, false);
      ajax.open("POST", "http://localhost:8080/api/v1/upload");
      ajax.send(formData);
    }

    function _(id) {
      return document.getElementById(id);
    }

    function progressHandler(event) {
      var percent = (event.loaded / event.total) * 100;
      _("progressBar").value = Math.round(percent);
      _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
      _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " of " + event.total + " bytes";
    }

    function completeHandler(event) {
      _("status").innerHTML = event.target.responseText;
    }

    function errorHandler() {
      _("status").innerHTML = "Upload Failed";
    }

    function abortHandler() {
      _("status").innerHTML = "Upload Aborted";
    }
  </script>
</body>

</html>